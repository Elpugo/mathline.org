<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Math Line</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    text-align: center;
    color: #f0f0f0;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    background: linear-gradient(-45deg, #1a0000, #4a0d0d, #7d1a1a, #2a0000, #ffb300);
    background-size: 400% 400%;
    animation: moveBackground 12s ease infinite;
  }
  @keyframes moveBackground {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  #bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
  }
  header {
    background: linear-gradient(90deg, #7d1a1a, #b30000, #ffb300);
    padding: 25px;
    border-bottom: 3px solid #000;
    box-shadow: 0 4px 15px rgba(0,0,0,0.7);
  }
  header h1 {
    margin: 0;
    font-size: 2.8em;
    color: #fff;
    text-shadow: 0 0 15px #ffb300;
  }
  header p {
    color: #ffdb91;
    font-size: 1.2em;
    margin-top: 5px;
  }
  #search-container {
    margin: 20px 0 0 0;
  }
  #search-input {
    padding: 10px 15px;
    width: 250px;
    font-size: 16px;
    border-radius: 8px;
    border: 2px solid #ffb300;
    outline: none;
    background: #1a0a0a;
    color: #ffb300;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  }
  .game-list {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 30px;
    padding: 20px;
    margin-top: 10px;
  }
  .game-card {
    position: relative;
    background: linear-gradient(145deg, #2a0a0a, #1a0a0a);
    border: 2px solid #ffb300;
    border-radius: 16px;
    width: 230px;
    padding: 30px 20px;
    cursor: pointer;
    transition: transform 0.25s, box-shadow 0.25s;
    box-shadow: 0 6px 14px rgba(0,0,0,0.5);
  }
  .game-card:hover {
    transform: translateY(-8px) scale(1.03);
    box-shadow: 0 12px 25px rgba(255,179,0,0.6), 0 0 25px #ffb300;
  }
  .game-card span {
    font-size: 1.3em;
    font-weight: bold;
    color: #ffb300;
    display: block;
    margin-top: 10px;
    text-shadow: 0 0 8px #b30000;
  }
  .favorite-star {
    position: absolute;
    top: 10px;
    right: 12px;
    font-size: 22px;
    color: #555;
    cursor: pointer;
    transition: color 0.2s, transform 0.2s;
    user-select: none;
  }
  .favorite-star.favorited {
    color: #ffb300;
    transform: scale(1.2);
  }
  .glow-card {
    background: linear-gradient(145deg, #3a0a0a, #1e1e2e);
    box-shadow: 0 0 25px #ffb300, 0 0 45px #b30000;
    border: 2px solid #ffb300;
  }
  .glow-card:hover {
    transform: translateY(-8px) scale(1.05);
    box-shadow: 0 0 40px #ffb300, 0 0 60px #b30000;
  }
  .back-btn, .fullscreen-btn {
    display: none;
    position: fixed;
    top: 20px;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    transition: transform 0.2s, opacity 0.3s;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  }
  .back-btn { left: 20px; background: linear-gradient(90deg, #b30000, #ffb300); }
  .fullscreen-btn { right: 20px; background: linear-gradient(90deg, #ffb300, #b30000); }
  .back-btn:hover, .fullscreen-btn:hover { transform: scale(1.07); opacity: 0.9; }
  iframe {
    display: none;
    width: 95%;
    height: 650px;
    margin: 0 auto;
    border: none;
    border-radius: 14px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.6);
    background: #000;
  }
  footer {
    margin-top: 60px;
    padding: 25px;
    background: #1a0a0a;
    border-top: 3px solid #ffb300;
    color: #ffdb91;
    font-size: 0.95em;
    box-shadow: 0 -4px 12px rgba(0,0,0,0.5);
  }
</style>
</head>
<body>
<canvas id="bg"></canvas>

<header>
  <h1>Math Line</h1>
  <p>New and improved — now with save support! Share to whoever but it can still be blocked</p>
</header>

<!-- SEARCH BAR -->
<div id="search-container">
  <input type="text" id="search-input" placeholder="Search games..." oninput="filterGames()">
</div>

<!-- GAME MENU -->
<div class="game-list" id="game-list"></div>

<!-- Back & Fullscreen Buttons -->
<button class="back-btn" id="back-btn" onclick="goBack()">⬅ Back</button>
<button class="fullscreen-btn" id="fullscreen-btn" onclick="goFullscreen()">⛶ Fullscreen</button>

<!-- Game Display -->
<iframe id="game-frame"></iframe>

<footer>
  <p>Made with ❤️ for players</p>
</footer>

<script>
/* === PARTICLE BACKGROUND === */
const canvas = document.getElementById('bg');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth;
canvas.height = innerHeight;

let particles = Array.from({ length: 70 }, () => ({
  x: Math.random() * canvas.width,
  y: Math.random() * canvas.height,
  r: Math.random() * 2 + 1,
  dx: (Math.random() - 0.5) * 0.5,
  dy: (Math.random() - 0.5) * 0.5,
  color: Math.random() > 0.5 ? 'rgba(255,179,0,0.8)' : 'rgba(179,0,0,0.8)'
}));

function animate() {
  ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  particles.forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fillStyle = p.color;
    ctx.fill();
    p.x += p.dx;
    p.y += p.dy;
    if (p.x < 0 || p.x > canvas.width) p.dx *= -1;
    if (p.y < 0 || p.y > canvas.height) p.dy *= -1;
  });
  requestAnimationFrame(animate);
}
animate();

/* === GAME LOADING === */
function loadGame(url) {
  document.getElementById("game-list").style.display = "none";
  document.getElementById("back-btn").style.display = "inline-block";
  document.getElementById("fullscreen-btn").style.display = "inline-block";
  const frame = document.getElementById("game-frame");
  frame.src = url;
  frame.style.display = "block";
  window.scrollTo(0,0);
}

function goBack() {
  document.getElementById("game-list").style.display = "flex";
  document.getElementById("back-btn").style.display = "none";
  document.getElementById("fullscreen-btn").style.display = "none";
  const frame = document.getElementById("game-frame");
  frame.src = "";
  frame.style.display = "none";
}

function goFullscreen() {
  const frame = document.getElementById("game-frame");
  if (frame.requestFullscreen) frame.requestFullscreen();
  else if (frame.webkitRequestFullscreen) frame.webkitRequestFullscreen();
  else if (frame.msRequestFullscreen) frame.msRequestFullscreen();
}

/* === FAVORITES SYSTEM === */
let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

function toggleFavorite(e, url) {
  e.stopPropagation(); // prevent card click
  if (favorites.includes(url)) {
    favorites = favorites.filter(f => f !== url);
  } else {
    favorites.push(url);
  }
  localStorage.setItem('favorites', JSON.stringify(favorites));
  createGameCards();
}

function isFavorited(url) {
  return favorites.includes(url);
}

function loadFavorites() {
  favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
}

/* === GAMES ARRAY === */
const games = [
  { name: 'Ragdoll Archers', url: 'ragdoll-archers.html' },
  { name: 'Ragdoll Hit', url: 'Ragdoll-hit.html' },
  { name: 'Time Shooter', url: 'Time-shooter.html' },
  { name: 'Retro Bowl', url: 'Retro-Bowl.html' },
  { name: 'Snow Rider', url: 'snow-rider.html' },
  { name: 'Swords & Sandals', url: 'swords-and-sandlas.html' },
  { name: 'Crazy Cattle', url: 'Crazy-Cattle.html' },
  { name: 'Gladi Hoppers', url: 'Gladi-hoppers.html' },
  { name: 'Bit Planes', url: 'clbitplanes.html' },
  { name: 'Final Earth 2', url: 'clfinalearth2.html' },
  { name: 'Cluster Rush', url: 'clclusterrush.html' },
  { name: 'Push your luck', url: 'clpushyourluck.html' },
  { name: 'Poly Track', url: 'clpolytrackworksnow.html' },
  { name: 'Ragdoll soccer', url: 'clragdollsoccer.html' },
  { name: 'JetPack Joy Ride', url: 'cljetpackjoyride.html' },
  { name: 'Learn to fly 3', url: 'cllearntofly3.html' },
  { name: 'Malidin stun cars', url: 'maldin-stun-cars.html' },
  { name: 'Gun Spin', url: 'clgunspin.html' },
  { name: 'Age of war 2', url: 'clageofwar2.html' },
  { name: 'Moto X3M 2', url: 'clmotox3m2.html' },
  { name: 'Moto X3M Winter', url: 'clmotox3mwinter.html' },
  { name: 'Basketball stars', url: 'clbasketballstars.html' },
  { name: 'Idle breakout', url: 'idle-breakout.html' },
  { name: 'Vex 8', url: 'vex8.html' },
  { name: 'Monkey Mart', url: 'monkey-mart.html' },
  { name: 'Drive Mad', url: 'drive-mad.html' }
];

/* === CREATE GAME CARDS === */
function createGameCards() {
  const gameList = document.getElementById('game-list');
  gameList.innerHTML = '';
  games.forEach(game => {
    const card = document.createElement('div');
    card.className = 'game-card';
    card.onclick = () => loadGame(game.url);

    const star = document.createElement('div');
    star.className = 'favorite-star';
    if (isFavorited(game.url)) star.classList.add('favorited');
    star.textContent = '★';
    star.onclick = e => toggleFavorite(e, game.url);

    const title = document.createElement('span');
    title.textContent = game.name;

    card.appendChild(star);
    card.appendChild(title);
    gameList.appendChild(card);
  });

  // Add the glowing external request link
  const glowCard = document.createElement('div');
  glowCard.className = 'game-card glow-card';
  const link = document.createElement('a');
  link.href = "https://docs.google.com/forms/d/e/1FAIpQLSevmKWapDp5CV1txbj9HlnanJkNoYr10ifpDQs6OvstLCckMA/viewform?usp=sharing";
  link.target = "_blank";
  link.style.textDecoration = "none";
  link.style.color = "inherit";
  link.style.display = "block";
  const span = document.createElement('span');
  span.textContent = "Request a Game";
  link.appendChild(span);
  glowCard.appendChild(link);
  gameList.appendChild(glowCard);
}

/* === FILTER SEARCH === */
function filterGames() {
  const input = document.getElementById('search-input').value.toLowerCase();
  const cards = document.querySelectorAll('.game-card');
  cards.forEach(card => {
    const name = card.querySelector('span')?.textContent.toLowerCase();
    if (!name) return;
    card.style.display = name.includes(input) ? 'block' : 'none';
  });
}

window.addEventListener('resize', () => {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
});
window.onload = () => {
  window.scrollTo(0,0);
  loadFavorites();
  createGameCards();
};
</script>
</body>
</html>
